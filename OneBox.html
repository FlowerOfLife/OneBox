<script src="js/jsPlumb-2.1.7.js"></script>
<script src="js/jquery-1.12.0.js"></script>
<script src="js/qwerty-hancock.js"></script>
<script src="js/nexusUI.js"></script>
<script type="text/javascript" src="./js/mml.js"></script>

<!--BOX-->
<script src="boxClasses/boxEntery.js"></script>
<script src="boxClasses/boxControlls.js"></script>
<script src="boxClasses/boxUI.js"></script>
<script src="boxClasses/boxController.js"></script>



<!--SaveLoad-->
<script src="manageClasses/saveLoadClass.js"></script>
<!--events-->
<script src="manageClasses/connectorsEvents.js"></script>



<!--**************************** tonejs************************************************* -->
	<script type="text/javascript" src="Tone.js/examples/scripts/draggabilly.js"></script>
<script type="text/javascript" src="js/Tone.js"></script>

	<script type="text/javascript" src="interface.js/build/interface.js"></script>





<!--**************************** tools************************************************* -->
<script src="manageClasses/menu.js"></script>

<script src="toolsClasses/osc.js"></script>

<script src="toolsClasses/polyOsc.js"></script>

<script src="toolsClasses/dashboard.js"></script>
<script src="toolsClasses/audioDestination.js"></script>
<script src="js/jquery-1.12.0.js">
</script>
<script src="js/jquery-ui.js"></script>
<script src="toolsClasses/visualiser.js"></script>
<script src="toolsClasses/audioDestination.js"></script>
<script src="toolsClasses/audioGain.js"></script>
<script src="toolsClasses/knob.js"></script>
<script src="toolsClasses/piano.js"></script>
<script src="toolsClasses/envelope.js"></script>
<script src="toolsClasses/simpleSequencer.js"></script>
<script src="toolsClasses/mml.js"></script>
<script src="toolsClasses/drums.js"></script>
<script src="toolsClasses/filter.js"></script>
<script src="toolsClasses/buffer.js"></script>
<script src="toolsClasses/midi.js"></script>
<script src="toolsClasses/lineSequencer.js"></script>

<script src="toolsClasses/toneFmSynth.js"></script>
<script src="toolsClasses/monoSequenecer.js"></script>

<!--**************************** tools************************************************* -->



<!--**************************** MIDI.JS************************************************* -->
<!-- polyfill -->
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<!-- polyfill -->
<script src="MIDI.js/inc/shim/Base64.js" type="text/javascript"></script>
<script src="MIDI.js/inc/shim/Base64binary.js" type="text/javascript"></script>
<script src="MIDI.js/inc/shim/WebAudioAPI.js" type="text/javascript"></script>
<!-- midi.js package -->
<script src="MIDI.js/js/midi/audioDetect.js" type="text/javascript"></script>
<script src="MIDI.js/js/midi/gm.js" type="text/javascript"></script>
<script src="MIDI.js/js/midi/loader.js" type="text/javascript"></script>
<script src="MIDI.js/js/midi/plugin.audiotag.js" type="text/javascript"></script>
<script src="MIDI.js/js/midi/plugin.webaudio.js" type="text/javascript"></script>
<script src="MIDI.js/js/midi/plugin.webmidi.js" type="text/javascript"></script>
<script src="MIDI.js/js/midi/player.js" type="text/javascript"></script>
<script src="MIDI.js/js/midi/synesthesia.js" type="text/javascript"></script>

<!-- utils -->
<script src="MIDI.js/js/util/dom_request_xhr.js" type="text/javascript"></script>
<script src="MIDI.js/js/util/dom_request_script.js" type="text/javascript"></script>

<script src="MIDI.js/inc/jasmid/stream.js"></script>
<script src="MIDI.js/inc/jasmid/midifile.js"></script>
<script src="MIDI.js/inc/jasmid/replayer.js"></script>
<!--**************************** MIDI.JS************************************************* -->




<link rel="stylesheet" href="css/window.css" media="screen" charset="utf-8">
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
<!--**************************** GOOGLE FONTS************************************************* -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<!--****************************GOOGLE FONTS************************************************* -->
<div id="floatMenu">|
	<button id='saveAll'>save</button><br />
	<button id='saveAll'>save</button><br />
	<input type="file" id='LoadInstrument'>Load</button>
</div>

<!--  <div id='diagramContainer'></div>-->
</body>
<script>
    var context = new AudioContext()
    $(document).ready(function () {
        //init Obeject
        jsPlumb.Defaults.Container = $("body"); // <-- Provide default conatiner
        jsPlumb.ready(function () {

            var eve = new eventsActions()
            eve.events();
        })

       
    })


nx.onload = function() {
nx.colorize("accent", "#1CEE81");
			    nx.colorize("border", "#1CEE81");
			    nx.colorize("fill", "#335464");
                nx.colorize("lable", "black");

}
setTimeout(function(){
nx.labelSize(40);
},2000)

    /*var myDashboard = new dashboard();
    myDashboard.createDashboard('mydash');
    */

    var myDashboard = new dashboard();


//*****************************************save*************************
    var saveAll = document.getElementById('saveAll');
  


    var sl = new saveLoad();
function downloadJsonFile(data, filename, type) {
    var a = document.createElement("a"),
        file = new Blob([data], {type: type});
    if (window.navigator.msSaveOrOpenBlob) // IE10+
        window.navigator.msSaveOrOpenBlob(file, filename);
    else { // Others
        var url = URL.createObjectURL(file);
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(function() {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);  
        }, 0); 
    }
}


    saveAll.onclick = function () {
        downloadJsonFile(JSON.stringify(sl.saveProject()),'save.json','text')
        dashboard1BoxBox.changeView('SdkView');
           // var saveUrl = ("http://localhost:8080/OneBox.html?jsonProject=" + sl.EncBase64(JSON.stringify(sl.saveProject())))

            function copyToClipboard(text) {
                window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
            }
          //  copyToClipboard(saveUrl)

        }
//*****************************************save*************************

//default json
    var loadJson = {
        "devices": {
            "dashboard1": {
                "name": "dashboard1Box",
                "type": "dashboard",
                "sdkTop": "1px",
                "sdkLeft": "1px",
                "guiTop": "88px",
                "guiLeft": "10px",
                "parentBox": "",
                "currentView": "SdkView",
                "isShowInGui": true
            },
        
        "connections": {
      
        }
    }}

    var sl = new saveLoad(loadJson);
   //*****************************************LOAD*************************
   //Load Button (load instrument)
     var LoadInstrument = document.getElementById('LoadInstrument');
        LoadInstrument.onchange = function () {
            var url = URL.createObjectURL(this.files[0]);
            $.getJSON( url , function( result ){
                 sl.loadProject(result)
            });
        };


   //Load Test Preset
    if (sl.loadFromUrl()) {
        $.getJSON("instruments/drumBox.json", function(json) {  
            console.log(json)
            sl.loadProject(json)
        });
    } else {
        //Load default preset        
        sl.loadProject(loadJson)

    }

</script>
